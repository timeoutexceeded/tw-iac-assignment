# Milestone 1 – Serverless Lambda with Terraform & Tests

## Overview
This project provisions a simple **Hello World AWS Lambda** behind an **API Gateway** using **Terraform**, and validates it with **unit tests, integration tests, and infrastructure tests**.

The goal of Milestone 1 is to:
- Deploy a basic Lambda function (`hello-world`) using Terraform  
- Expose it via an API Gateway endpoint  
- Write tests to ensure both the code and infrastructure behave correctly  

---

## Project Structure
```
.
├── infra/                 # Terraform code
│   ├── main.tf
│   ├── output.tf
│   ├── provider.tf
│   ├── variables.tf
│   ├── dev.tfvars         # Added to .gitignore
│   ├── .terraform.lock.hcl
│   └── .env               # Auto-generated during runtime to store API_URL
│
├── src/                   # Lambda source code
│   └── lambda/
│       └── hello-world.js
│
├── test/
│   ├── infra/             # Infrastructure tests
│   │   └── terraform.test.js
│   └── lambda/            # Unit & integration tests
│       ├── integration
│       │   └── hello-world.test.js
│       └── unit
│           └── hello-world.unit.test.js
│
├── package.json
└── README.md
```

---

## Setup

### 1. Install dependencies

```
npm install
```


### 2. Provision Infrastructure
Before you run the following commands, make sure you setup dev.tfvars file inside infra folder with the following variables:

```
region = <REGION>
prefix = <PREFIX>
```

Run the following commands to set up the infrastructure:

```
cd infra
terraform init
terraform plan -auto-approve -var-file="dev.tfvars"
terraform apply -auto-approve -var-file="dev.tfvars"
```

This will:
- Create a Lambda function **`<dev.tfvars[prefix]>-hello-world`**
- Create an **API Gateway**
- Generate a **`.env` file** in `infra/` containing the API URL


Example `.env` file  

Auto-generated by Terraform after `apply`:  

```
API_URL=https://abc123.execute-api.ap-south-1.amazonaws.com/dev/hello
```

### 3. Provision Infrastructure
Make sure you delete the infrastructure after testing by using

```
terraform destroy -auto-approve -var-file="dev.tfvars"
```

## Testing

### Unit Tests

Tests the Lambda function logic locally without deploying to AWS:

```
npm run test:unit
```

### Integration Tests

Calls the deployed API Gateway endpoint to verify Lambda works in AWS:

```
npm run test:integration
```

### Infra Tests

Validates Terraform outputs and .env file:

```
npm run test:infra
```

## NPM Scripts

Defined in package.json:

```
"scripts": {
    "test:unit": "jest test/lambda/unit/hello-world.unit.test.js",
    "test:integration": "jest test/lambda/integration/hello-world.test.js",
    "test": "npm run test:unit && npm run test:integration",
    "test:infra": "jest test/infra/terraform.test.js"
  },
```